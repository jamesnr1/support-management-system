<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>NDIS Hour Tracker - Real Data</title>
    <style>
        body { font-family: Arial, sans-serif; background: #2D2B28; color: #E8DDD4; padding: 20px; }
        .container { max-width: 1400px; margin: 0 auto; }
        .header { background: #3E3B37; padding: 20px; border-radius: 8px; margin-bottom: 20px; }
        .title { color: #D4A574; font-size: 24px; margin-bottom: 15px; }
        .participant-card { background: #3E3B37; border-radius: 8px; margin-bottom: 20px; overflow: hidden; }
        .participant-header { background: #4A4641; padding: 15px; display: flex; justify-content: space-between; align-items: center; }
        .participant-name { color: #D4A574; font-size: 18px; }
        .ndis-number { color: #9A8F85; font-size: 12px; }
        .hour-summary { padding: 15px; }
        .hour-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin-bottom: 20px; }
        .hour-block { background: #4A4641; padding: 12px; border-radius: 6px; }
        .hour-type { color: #D4A574; font-weight: bold; margin-bottom: 8px; font-size: 11px; }
        .hour-bar { background: #2D2B28; height: 16px; border-radius: 8px; overflow: hidden; margin: 6px 0; }
        .hour-fill { height: 100%; transition: width 0.3s ease; }
        .hour-fill.good { background: linear-gradient(90deg, #5A7A5A, #6B8B6B); }
        .hour-fill.warning { background: linear-gradient(90deg, #D4A574, #E5B685); }
        .hour-fill.critical { background: linear-gradient(90deg, #7A5A5A, #8B6B6B); }
        .hour-fill.empty { background: linear-gradient(90deg, #444, #555); }
        .hour-text { display: flex; justify-content: space-between; font-size: 11px; margin-top: 4px; }
        .remaining-hours { color: #E8DDD4; font-weight: bold; }
        .total-hours { color: #9A8F85; }
        .ratio-multiplier { color: #C4B5A8; font-size: 10px; margin-top: 2px; }
        .weekly-usage { background: #2D2B28; padding: 15px; border-radius: 6px; margin-top: 15px; }
        .usage-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .week-block { background: #3E3B37; padding: 10px; border-radius: 4px; text-align: center; }
        .week-number { color: #D4A574; font-weight: bold; margin-bottom: 5px; }
        .week-hours { font-size: 12px; }
        .controls { display: flex; gap: 10px; margin-bottom: 20px; align-items: center; }
        .input-group { display: flex; flex-direction: column; margin-right: 15px; }
        .input-group label { color: #C4B5A8; font-size: 12px; margin-bottom: 3px; }
        .plan-input { background: #2D2B28; color: #E8DDD4; border: 1px solid #D4A574; border-radius: 4px; padding: 6px; }
        .btn { padding: 8px 16px; border: none; border-radius: 4px; cursor: pointer; margin: 2px; font-size: 12px; }
        .btn-primary { background: #D4A574; color: #2D2B28; }
        .btn-warning { background: #D4A574; color: #2D2B28; }
        .btn-danger { background: #7A5A5A; color: #E8DDD4; }
        .btn-secondary { background: #4A4641; color: #E8DDD4; }
        .warning-panel { background: #7A5A5A; color: white; padding: 12px; border-radius: 6px; margin: 10px 0; font-size: 12px; }
        .success-panel { background: #5A7A5A; color: white; padding: 12px; border-radius: 6px; margin: 10px 0; font-size: 12px; }
        .info-panel { background: #4A4641; padding: 15px; border-radius: 6px; margin: 10px 0; font-size: 12px; }
        .summary-totals { background: #3E3B37; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .total-grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(150px, 1fr)); gap: 15px; }
        .total-item { text-align: center; }
        .total-value { color: #D4A574; font-size: 20px; font-weight: bold; }
        .total-label { color: #9A8F85; font-size: 12px; margin-top: 5px; }
        .csv-upload { background: #3E3B37; padding: 15px; border-radius: 8px; margin-bottom: 20px; }
        .file-input { background: #2D2B28; color: #E8DDD4; border: 1px solid #D4A574; border-radius: 4px; padding: 8px; width: 100%; margin: 10px 0; }
    </style>
</head>
<body>

<div class="container">
    <div class="header">
        <h1 class="title">NDIS Hour Tracker - Remaining Hours After Fraud Discovery</h1>
        <div class="controls">
            <div class="input-group">
                <label>Current Week:</label>
                <select id="currentWeek" class="plan-input">
                    <option value="1">Week 1</option>
                    <option value="2">Week 2</option>
                    <option value="3">Week 3</option>
                    <option value="4">Week 4</option>
                </select>
            </div>
            <div class="input-group">
                <label>Weeks Left in Plan:</label>
                <input type="number" id="weeksRemaining" class="plan-input" value="20" style="width: 80px;">
            </div>
            <button class="btn btn-primary" onclick="TRACKER.calculateProjection()">Calculate Projection</button>
            <button class="btn btn-warning" onclick="TRACKER.showCSVUpload()">Update Plan Data</button>
            <button class="btn btn-secondary" onclick="TRACKER.exportData()">Export Report</button>
        </div>
    </div>

    <div id="csvUpload" class="csv-upload" style="display: none;">
        <h3 style="color: #D4A574; margin-bottom: 10px;">Upload Updated NDIS Plan Data</h3>
        <input type="file" id="csvFile" class="file-input" accept=".csv" onchange="TRACKER.loadCSVData(event)">
        <p style="color: #9A8F85; font-size: 12px; margin-top: 10px;">
            Upload your "Rostering Information Grid view.csv" file when you receive new NDIS plans
        </p>
    </div>

    <div class="summary-totals">
        <h3 style="color: #D4A574; margin-bottom: 15px;">Plan Summary</h3>
        <div class="total-grid">
            <div class="total-item">
                <div class="total-value" id="totalSelfCare">0</div>
                <div class="total-label">Self-Care Hours Remaining</div>
            </div>
            <div class="total-item">
                <div class="total-value" id="totalCommunity">0</div>
                <div class="total-label">Community Hours Remaining</div>
            </div>
            <div class="total-item">
                <div class="total-value" id="weeksProjection">0</div>
                <div class="total-label">Weeks Until Exhausted</div>
            </div>
            <div class="total-item">
                <div class="total-value" id="riskLevel">LOW</div>
                <div class="total-label">Risk Level</div>
            </div>
        </div>
    </div>

    <div id="participantCards"></div>

    <div class="info-panel">
        <h3 style="color: #D4A574; margin-bottom: 10px;">How Support Ratios Affect NDIS Hour Consumption</h3>
        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: 15px;">
            <div>
                <p><strong>2:1 Individual Support:</strong></p>
                <p>• 2 workers for 1 participant</p>
                <p>• 1 hour of service = 2 NDIS hours consumed</p>
                <p>• Higher cost but intensive support</p>
            </div>
            <div>
                <p><strong>2:3 Shared Support:</strong></p>
                <p>• 2 workers for 3 participants</p>
                <p>• 1 hour of service = 0.67 NDIS hours per participant</p>
                <p>• Cost-effective for compatible participants</p>
            </div>
            <div>
                <p><strong>1:1 Individual Support:</strong></p>
                <p>• 1 worker for 1 participant</p>
                <p>• 1 hour of service = 1 NDIS hour consumed</p>
                <p>• Standard individual support ratio</p>
            </div>
        </div>
    </div>
</div>

<script>
const TRACKER = {
    // Real NDIS remaining hours data from CSV
    remainingHours: {
        'James': {
            name: 'James Narula',
            ndis: '430961531',
            'Self-Care Weekday': 0, // Will be loaded from CSV
            'Self-Care Weekday Evening': 0,
            'Self-Care Weekday Night': 0,
            'Self-Care Saturday': 0,
            'Self-Care Sunday': 0,
            'Self-Care Public Holiday': 0,
            'Community Participation Weekday': 0,
            'Community Participation Weekday Evening': 0,
            'Community Participation Saturday': 0,
            'Community Participation Sunday': 0,
            'Community Participation Public Holiday': 0
        },
        'Libby': {
            name: 'Elizabeth (Libby) Narula',
            ndis: '430463678',
            'Self-Care Weekday': 0,
            'Self-Care Weekday Evening': 0,
            'Self-Care Weekday Night': 0,
            'Self-Care Saturday': 0,
            'Self-Care Sunday': 0,
            'Self-Care Public Holiday': 0,
            'Community Participation Weekday': 0,
            'Community Participation Weekday Evening': 0,
            'Community Participation Saturday': 0,
            'Community Participation Sunday': 0,
            'Community Participation Public Holiday': 0
        },
        'Ace': {
            name: 'Ace Narula',
            ndis: '431066729',
            'Self-Care Weekday': 0,
            'Self-Care Weekday Evening': 0,
            'Self-Care Weekday Night': 0,
            'Self-Care Saturday': 0,
            'Self-Care Sunday': 0,
            'Self-Care Public Holiday': 0,
            'Community Participation Weekday': 0,
            'Community Participation Weekday Evening': 0,
            'Community Participation Saturday': 0,
            'Community Participation Sunday': 0,
            'Community Participation Public Holiday': 0
        },
        'Grace': {
            name: 'Grace Narula',
            ndis: '431066841',
            'Self-Care Weekday': 0,
            'Self-Care Weekday Evening': 0,
            'Self-Care Weekday Night': 0,
            'Self-Care Saturday': 0,
            'Self-Care Sunday': 0,
            'Self-Care Public Holiday': 0,
            'Community Participation Weekday': 0,
            'Community Participation Weekday Evening': 0,
            'Community Participation Saturday': 0,
            'Community Participation Sunday': 0,
            'Community Participation Public Holiday': 0
        },
        'Milan': {
            name: 'Milan Narula',
            ndis: '430959880',
            'Self-Care Weekday': 0,
            'Self-Care Weekday Evening': 0,
            'Self-Care Weekday Night': 0,
            'Self-Care Saturday': 0,
            'Self-Care Sunday': 0,
            'Self-Care Public Holiday': 0,
            'Community Participation Weekday': 0,
            'Community Participation Weekday Evening': 0,
            'Community Participation Saturday': 0,
            'Community Participation Sunday': 0,
            'Community Participation Public Holiday': 0
        }
    },

    // Support ratios affect how many NDIS hours are consumed per service hour
    supportRatios: {
        'James': {
            weekA: { day: '2:1', evening: '2:1', night: '2:1' },  // Individual 2:1
            weekB: { day: '2:3', evening: '2:3', night: '2:3' }   // Shared 2:3
        },
        'Libby': {
            weekA: { day: '2:3', evening: '2:3', night: '2:3' },  // Shared 2:3
            weekB: { day: '2:1', evening: '2:1', night: '2:1' }   // Individual 2:1
        },
        'Ace': {
            weekA: { day: '2:3', evening: '2:3', night: '2:3' },  // Shared 2:3 with Libby
            weekB: { day: '2:3', evening: '2:3', night: '2:3' }   // Shared 2:3 with James
        },
        'Grace': {
            weekA: { day: '2:3', evening: '2:3', night: '2:3' },  // Shared 2:3 with Libby
            weekB: { day: '2:3', evening: '2:3', night: '2:3' }   // Shared 2:3 with James
        },
        'Milan': {
            weekA: { day: '2:1', evening: '0:0', night: '0:0' },  // Individual day only
            weekB: { day: '2:1', evening: '0:0', night: '0:0' }   // Individual day only
        }
    },

    // Current weekly usage patterns (hours per week)
    weeklyUsage: {
        'James': { day: 98, evening: 14, night: 56 },  // Week A pattern
        'Libby': { day: 98, evening: 14, night: 0 },   // Week B pattern  
        'Ace': { day: 42.5, evening: 10, night: 0 },
        'Grace': { day: 42.5, evening: 10, night: 0 },
        'Milan': { day: 21, evening: 0, night: 0 }
    },

    // Calculate NDIS hours consumed based on support ratio
    calculateNDISHoursConsumed(serviceHours, ratio) {
        if (ratio === '2:1') return serviceHours * 2;      // 2 workers = 2x NDIS hours
        if (ratio === '2:3') return serviceHours * 0.67;   // Shared among 3 = 0.67x NDIS hours
        if (ratio === '1:1') return serviceHours * 1;      // 1 worker = 1x NDIS hours
        return serviceHours; // Default 1:1
    },

    // Load CSV data when user uploads new plan
    loadCSVData(event) {
        const file = event.target.files[0];
        if (!file) return;

        const reader = new FileReader();
        reader.onload = function(e) {
            try {
                const csv = e.target.result;
                const lines = csv.split('\n');
                const headers = lines[0].split(',');
                
                // Parse CSV data into remainingHours structure
                for (let i = 1; i < lines.length; i++) {
                    const values = lines[i].split(',');
                    if (values.length < 10) continue;
                    
                    const participantName = values[1];
                    const participantNumber = values[2];
                    
                    // Map participant names
                    let key = '';
                    if (participantName.includes('James')) key = 'James';
                    else if (participantName.includes('Libby') || participantName.includes('Elizabeth')) key = 'Libby';
                    else if (participantName.includes('Ace')) key = 'Ace';
                    else if (participantName.includes('Grace')) key = 'Grace';
                    else if (participantName.includes('Milan')) key = 'Milan';
                    
                    if (key && TRACKER.remainingHours[key]) {
                        // Update remaining hours from CSV
                        TRACKER.remainingHours[key]['Self-Care Weekday'] = parseInt(values[3]) || 0;
                        TRACKER.remainingHours[key]['Self-Care Weekday Evening'] = parseInt(values[8]) || 0;
                        TRACKER.remainingHours[key]['Self-Care Weekday Night'] = parseInt(values[13]) || 0;
                        TRACKER.remainingHours[key]['Self-Care Saturday'] = parseInt(values[18]) || 0;
                        TRACKER.remainingHours[key]['Self-Care Sunday'] = parseInt(values[23]) || 0;
                        TRACKER.remainingHours[key]['Self-Care Public Holiday'] = parseInt(values[28]) || 0;
                        TRACKER.remainingHours[key]['Community Participation Weekday'] = parseInt(values[33]) || 0;
                        TRACKER.remainingHours[key]['Community Participation Weekday Evening'] = parseInt(values[38]) || 0;
                        TRACKER.remainingHours[key]['Community Participation Saturday'] = parseInt(values[43]) || 0;
                        TRACKER.remainingHours[key]['Community Participation Sunday'] = parseInt(values[47]) || 0;
                        TRACKER.remainingHours[key]['Community Participation Public Holiday'] = parseInt(values[51]) || 0;
                    }
                }
                
                TRACKER.renderDashboard();
                document.getElementById('csvUpload').style.display = 'none';
                alert('✅ NDIS plan data updated successfully!');
                
            } catch (error) {
                alert('❌ Error parsing CSV file: ' + error.message);
            }
        };
        reader.readAsText(file);
    },

    // Calculate weekly projections
    calculateProjection() {
        const weeksRemaining = parseInt(document.getElementById('weeksRemaining').value) || 20;
        let totalSelfCare = 0;
        let totalCommunity = 0;
        let criticalParticipants = [];

        for (const [participant, hours] of Object.entries(TRACKER.remainingHours)) {
            if (typeof hours === 'object' && hours.name) {
                // Calculate total remaining hours per participant
                const selfCareTotal = 
                    hours['Self-Care Weekday'] + 
                    hours['Self-Care Weekday Evening'] + 
                    hours['Self-Care Weekday Night'] + 
                    hours['Self-Care Saturday'] + 
                    hours['Self-Care Sunday'] + 
                    hours['Self-Care Public Holiday'];

                const communityTotal = 
                    hours['Community Participation Weekday'] + 
                    hours['Community Participation Weekday Evening'] + 
                    hours['Community Participation Saturday'] + 
                    hours['Community Participation Sunday'] + 
                    hours['Community Participation Public Holiday'];

                totalSelfCare += selfCareTotal;
                totalCommunity += communityTotal;

                // Calculate weeks until exhaustion for this participant
                const usage = TRACKER.weeklyUsage[participant];
                const weeklyNDISConsumption = 
                    TRACKER.calculateNDISHoursConsumed(usage.day, '2:1') +   // Assuming worst case
                    TRACKER.calculateNDISHoursConsumed(usage.evening, '2:1') +
                    TRACKER.calculateNDISHoursConsumed(usage.night, '2:1');

                const weeksUntilExhausted = Math.floor((selfCareTotal + communityTotal) / weeklyNDISConsumption);
                
                if (weeksUntilExhausted < 8) {
                    criticalParticipants.push({
                        name: hours.name,
                        weeks: weeksUntilExhausted,
                        remaining: selfCareTotal + communityTotal
                    });
                }
            }
        }

        // Update summary display
        document.getElementById('totalSelfCare').textContent = totalSelfCare.toLocaleString();
        document.getElementById('totalCommunity').textContent = totalCommunity.toLocaleString();
        
        const averageWeeksLeft = Math.floor((totalSelfCare + totalCommunity) / (300 * 5)); // Rough estimate
        document.getElementById('weeksProjection').textContent = averageWeeksLeft;
        
        // Risk assessment
        let riskLevel = 'LOW';
        let riskColor = '#5A7A5A';
        if (averageWeeksLeft < 12) { riskLevel = 'MEDIUM'; riskColor = '#D4A574'; }
        if (averageWeeksLeft < 6) { riskLevel = 'HIGH'; riskColor = '#7A5A5A'; }
        
        const riskElement = document.getElementById('riskLevel');
        riskElement.textContent = riskLevel;
        riskElement.style.color = riskColor;

        // Show warnings for critical participants
        if (criticalParticipants.length > 0) {
            const warningHTML = criticalParticipants.map(p => 
                `<strong>${p.name}:</strong> Only ${p.weeks} weeks remaining (${p.remaining} hours)`
            ).join('<br>');
            
            const warningPanel = document.createElement('div');
            warningPanel.className = 'warning-panel';
            warningPanel.innerHTML = `<strong>⚠️ CRITICAL HOUR SHORTAGE:</strong><br>${warningHTML}`;
            
            const container = document.querySelector('.container');
            container.insertBefore(warningPanel, container.children[2]);
        }
    },

    // Render the dashboard
    renderDashboard() {
        const container = document.getElementById('participantCards');
        container.innerHTML = '';

        for (const [participant, data] of Object.entries(TRACKER.remainingHours)) {
            if (typeof data !== 'object' || !data.name) continue;

            const card = document.createElement('div');
            card.className = 'participant-card';

            // Calculate totals
            const selfCareHours = [
                data['Self-Care Weekday'],
                data['Self-Care Weekday Evening'], 
                data['Self-Care Weekday Night'],
                data['Self-Care Saturday'],
                data['Self-Care Sunday'],
                data['Self-Care Public Holiday']
            ];

            const communityHours = [
                data['Community Participation Weekday'],
                data['Community Participation Weekday Evening'],
                data['Community Participation Saturday'], 
                data['Community Participation Sunday'],
                data['Community Participation Public Holiday']
            ];

            card.innerHTML = `
                <div class="participant-header">
                    <div>
                        <div class="participant-name">${data.name}</div>
                        <div class="ndis-number">NDIS: ${data.ndis}</div>
                    </div>
                    <div style="text-align: right;">
                        <div style="color: #D4A574; font-weight: bold;">
                            ${selfCareHours.reduce((a, b) => a + b, 0) + communityHours.reduce((a, b) => a + b, 0)} Total Hours
                        </div>
                        <div style="color: #9A8F85; font-size: 12px;">
                            ${Math.floor((selfCareHours.reduce((a, b) => a + b, 0) + communityHours.reduce((a, b) => a + b, 0)) / 100)} weeks approx
                        </div>
                    </div>
                </div>
                <div class="hour-summary">
                    <div class="hour-grid">
                        ${TRACKER.createHourBlock('SCWD', data['Self-Care Weekday'], 1000, '2:1')}
                        ${TRACKER.createHourBlock('SCWE', data['Self-Care Weekday Evening'], 300, '2:1')}
                        ${TRACKER.createHourBlock('SCWN', data['Self-Care Weekday Night'], 400, '2:1')}
                        ${TRACKER.createHourBlock('SCSat', data['Self-Care Saturday'], 200, '2:1')}
                        ${TRACKER.createHourBlock('SCSun', data['Self-Care Sunday'], 200, '2:1')}
                        ${TRACKER.createHourBlock('SCPH', data['Self-Care Public Holiday'], 100, '2:1')}
                        ${TRACKER.createHourBlock('CPWD', data['Community Participation Weekday'], 800, '2:3')}
                        ${TRACKER.createHourBlock('CPWE', data['Community Participation Weekday Evening'], 200, '2:3')}
                        ${TRACKER.createHourBlock('CPSat', data['Community Participation Saturday'], 300, '2:3')}
                        ${TRACKER.createHourBlock('CPSun', data['Community Participation Sunday'], 300, '2:3')}
                        ${TRACKER.createHourBlock('CPPH', data['Community Participation Public Holiday'], 100, '2:3')}
                    </div>
                    ${TRACKER.createWeeklyUsageDisplay(participant)}
                </div>
            `;

            container.appendChild(card);
        }
    },

    createHourBlock(code, remaining, typical, ratio) {
        const percentage = Math.min((remaining / typical) * 100, 100);
        let fillClass = 'good';
        if (percentage < 20) fillClass = 'critical';
        else if (percentage < 40) fillClass = 'warning';
        if (remaining === 0) fillClass = 'empty';

        const multiplier = ratio === '2:1' ? '2x cost' : ratio === '2:3' ? '0.67x cost' : '1x cost';

        return `
            <div class="hour-block">
                <div class="hour-type">${code}</div>
                <div class="hour-bar">
                    <div class="hour-fill ${fillClass}" style="width: ${percentage}%"></div>
                </div>
                <div class="hour-text">
                    <span class="remaining-hours">${remaining}h</span>
                    <span class="total-hours">/${typical}h</span>
                </div>
                <div class="ratio-multiplier">${ratio} ratio (${multiplier})</div>
            </div>
        `;
    },

    createWeeklyUsageDisplay(participant) {
        const usage = TRACKER.weeklyUsage[participant];
        const ratios = TRACKER.supportRatios[participant];
        
        const weekAConsumption = 
            TRACKER.calculateNDISHoursConsumed(usage.day, ratios.weekA.day) +
            TRACKER.calculateNDISHoursConsumed(usage.evening, ratios.weekA.evening) +
            TRACKER.calculateNDISHoursConsumed(usage.night, ratios.weekA.night);

        const weekBConsumption = 
            TRACKER.calculateNDISHoursConsumed(usage.day, ratios.weekB.day) +
            TRACKER.calculateNDISHoursConsumed(usage.evening, ratios.weekB.evening) +
            TRACKER.calculateNDISHoursConsumed(usage.night, ratios.weekB.night);

        return `
            <div class="weekly-usage">
                <h4 style="color: #D4A574; margin-bottom: 10px;">Weekly NDIS Hour Consumption</h4>
                <div class="usage-grid">
                    <div class="week-block">
                        <div class="week-number">Week A</div>
                        <div class="week-hours">${weekAConsumption.toFixed(1)}h NDIS</div>
                        <div style="font-size: 10px; color: #9A8F85;">${usage.day + usage.evening + usage.night}h service</div>
                    </div>
                    <div class="week-block">
                        <div class="week-number">Week B</div>
                        <div class="week-hours">${weekBConsumption.toFixed(1)}h NDIS</div>
                        <div style="font-size: 10px; color: #9A8F85;">${usage.day + usage.evening + usage.night}h service</div>
                    </div>
                    <div class="week-block">
                        <div class="week-number">Monthly Avg</div>
                        <div class="week-hours">${((weekAConsumption + weekBConsumption) * 2).toFixed(1)}h</div>
                        <div style="font-size: 10px; color: #9A8F85;">per month</div>
                    </div>
                    <div class="week-block">
                        <div class="week-number">Efficiency</div>
                        <div class="week-hours">${(((usage.day + usage.evening + usage.night) / ((weekAConsumption + weekBConsumption) / 2)) * 100).toFixed(0)}%</div>
                        <div style="font-size: 10px; color: #9A8F85;">service/NDIS</div>
                    </div>
                </div>
            </div>
        `;
    },

    showCSVUpload() {
        const uploadDiv = document.getElementById('csvUpload');
        uploadDiv.style.display = uploadDiv.style.display === 'none' ? 'block' : 'none';
    },

    exportData() {
        // Export current hour tracking data as CSV
        let csv = 'Participant,NDIS Number,Service Type,Remaining Hours,Weekly Usage,Weeks Remaining\n';
        
        for (const [participant, data] of Object.entries(TRACKER.remainingHours)) {
            if (typeof data !== 'object' || !data.name) continue;
            
            // Add rows for each service type
            const services = [
                ['Self-Care Weekday', data['Self-Care Weekday']],
                ['Self-Care Evening', data['Self-Care Weekday Evening']],
                ['Self-Care Night', data['Self-Care Weekday Night']],
                ['Community Weekday', data['Community Participation Weekday']],
                ['Community Evening', data['Community Participation Weekday Evening']]
            ];
            
            services.forEach(([service, hours]) => {
                const weeklyUsage = TRACKER.weeklyUsage[participant] ? 
                    (TRACKER.weeklyUsage[participant].day + TRACKER.weeklyUsage[participant].evening + TRACKER.weeklyUsage[participant].night) / 3 : 50;
                const weeksRemaining = Math.floor(hours / weeklyUsage);
                
                csv += `"${data.name}","${data.ndis}","${service}",${hours},${weeklyUsage.toFixed(1)},${weeksRemaining}\n`;
            });
        }
        
        // Download CSV
        const blob = new Blob([csv], { type: 'text/csv' });
        const url = window.URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `ndis-hour-tracking-${new Date().toISOString().split('T')[0]}.csv`;
        a.click();
        window.URL.revokeObjectURL(url);
    },

    init() {
        // Load demo data or wait for CSV upload
        TRACKER.renderDashboard();
        TRACKER.calculateProjection();
    }
};

// Initialize on page load
document.addEventListener('DOMContentLoaded', TRACKER.init);
</script>

</body>
</html>